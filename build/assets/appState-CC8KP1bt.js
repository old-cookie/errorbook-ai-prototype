const c="errorbook:settings",d="errorbook:progress",l="errorbook:applied-sessions",r={showEri:!0,reduceMotion:!1},a={totalXP:1230,streakDays:7,badgesEarned:2,missionsCompletedToday:1,lastSessionScore:2,lastSessionTotal:3,lastSessionAt:null};function i(e,t){if(!e)return t;try{return JSON.parse(e)}catch{return t}}function s(){return typeof window<"u"}function p(){return s()?{...r,...i(window.localStorage.getItem(c),r)}:r}function P(e){const t={...p(),...e};return s()&&window.localStorage.setItem(c,JSON.stringify(t)),t}function w(){return s()?{...a,...i(window.localStorage.getItem(d),a)}:a}function E(e){return s()&&window.localStorage.setItem(d,JSON.stringify(e)),e}function S(){return s()?i(window.localStorage.getItem(l),[]):[]}function k(e){if(!s())return;const t=S();t.includes(e)||window.localStorage.setItem(l,JSON.stringify([...t,e]))}function I(e,t){const o=Math.max(0,Math.min(e,t));return 15+o*5+(o===t?10:0)}function b(e){const t=w();if(S().includes(e.sessionId))return{progress:t,rewards:{xpEarned:0,streakChanged:"same"}};const o=I(e.score,e.total),n=(e.total>0?e.score/e.total:0)>=.67?t.streakDays+1:Math.max(1,t.streakDays-1),u=n>t.streakDays?"up":n<t.streakDays?"down":"same",f={...t,totalXP:t.totalXP+o,streakDays:n,missionsCompletedToday:Math.min(3,t.missionsCompletedToday+1),badgesEarned:e.score===e.total?t.badgesEarned+1:t.badgesEarned,lastSessionScore:e.score,lastSessionTotal:e.total,lastSessionAt:new Date().toISOString()};return k(e.sessionId),{progress:E(f),rewards:{xpEarned:o,streakChanged:u}}}export{p as a,b,I as e,w as g,P as u};
